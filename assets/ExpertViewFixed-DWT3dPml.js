import{a as ge,k as _,u as me,Z as ve,i as he,L as d,j as _e,l as we,m as ye,r as ke,b as c,o as l,e,n as S,c as Ue,f as m,w as ae,g as y,t as u,X as oe,q as k,F as D,v as ne,x as Se,W as De,J as P,G as Ce,a4 as Ae,V as q,a2 as Be}from"./index-DHhmkvBm.js";import{u as Ee}from"./expertUi-DtyoothA.js";import{e as Ne}from"./index-DfBlkqaH.js";import{u as je}from"./stars-B7JsDl3t.js";import{u as Te}from"./hiring-CBPf2Wtt.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ie={class:"min-h-screen bg-[#F8FAFC] pb-10 font-manrope"},Me={class:"px-4 sm:px-6 lg:px-8 pt-28 mt-5"},Ve={key:0,class:"animate-pulse space-y-8"},$e={key:1,class:"space-y-2"},He={key:0,class:"bg-blue-50 border-l-4 border-blue-600 p-6 rounded-2xl shadow-sm flex flex-col md:flex-row items-center justify-between gap-6"},Le={class:"flex items-start gap-4"},Re={class:"p-3 bg-blue-100 rounded-xl text-blue-600"},Oe={class:"text-blue-700 text-sm mt-1"},Pe={class:"font-bold underline"},qe={class:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start"},ze={class:"lg:col-span-4 space-y-6"},Je={class:"rounded-[2.5rem] shadow-xl shadow-slate-200/50 overflow-hidden border border-slate-100 group"},Ge={class:"p-8 text-center"},Xe={class:"relative group inline-block mb-6"},Ye={class:"w-32 h-32 rounded-[2rem] overflow-hidden ring-4 ring-offset-4 ring-blue-500 transition-all group-hover:scale-105"},Ze=["src","alt"],Ke={class:"text-2xl font-extrabold text-slate-800 tracking-tight"},We={class:"text-blue-600 font-semibold text-sm mt-1 uppercase tracking-wider"},Qe={key:0,class:"mt-2 inline-flex items-center px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs font-bold border border-red-100"},et={class:"mt-6 flex items-center justify-center gap-2 bg-slate-50 rounded-2xl py-3 px-4"},tt={class:"flex items-center gap-1"},st={class:"text-xl font-bold text-slate-800"},at={class:"text-xs text-slate-500 font-medium"},ot={class:"border-t border-slate-100 bg-slate-50/50 p-6 space-y-4"},nt={class:"flex items-center justify-between"},lt={class:"text-sm font-semibold text-slate-700"},rt={class:"flex items-center justify-between"},it={class:"text-sm font-semibold text-slate-700"},dt={class:"flex items-center justify-between"},ct={class:"text-sm font-semibold text-slate-700"},ut={class:"flex items-center justify-between flex-col"},pt={class:"text-sm font-semibold text-slate-700"},xt={class:"bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100 grid grid-cols-2 gap-4"},ft={class:"p-4 bg-blue-50 rounded-2xl text-center"},bt={class:"text-2xl font-bold text-blue-700"},gt={class:"p-4 bg-blue-50 rounded-2xl text-center"},mt={class:"text-2xl font-bold text-blue-700"},vt={class:"text-[10px] font-bold text-blue-600/70 uppercase"},ht={class:"lg:col-span-8 space-y-8"},_t={class:"bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden"},wt={class:"p-8 pb-0 flex flex-col sm:flex-row sm:items-center justify-between gap-4"},yt={class:"flex items-center gap-3"},kt={class:"p-2.5 bg-blue-600 rounded-xl text-white shadow-lg shadow-blue-200"},Ut={key:0,class:"flex items-center gap-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-xl border border-blue-100 ring-1 ring-blue-100"},St={class:"text-xs font-bold"},Dt={class:"p-4"},Ct={key:0,class:"flex overflow-x-auto gap-6 pb-2 scrollbar-hide"},At={class:"text-center py-2 bg-slate-50 rounded-xl border border-slate-100 text-blue-700 font-bold text-sm"},Bt={class:"space-y-3"},Et=["onClick","disabled"],Nt={class:"text-[9px] uppercase tracking-widest opacity-80"},jt={key:1,class:"text-center py-12 bg-slate-50 rounded-[2rem] border-2 border-dashed border-slate-200"},Tt={key:0,class:"bg-gradient-to-r from-blue-700 to-blue-700 p-6 flex flex-col md:flex-row items-center justify-between gap-6"},Ft={class:"flex items-center gap-4"},It={class:"p-3 bg-white/20 rounded-2xl text-white backdrop-blur-md"},Mt={class:"text-white font-bold text-lg md:text-xl"},Vt=["disabled"],$t={key:0,class:"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-blue-900/40 backdrop-blur-sm transition-all"},Ht={class:"relative"},Lt={class:"absolute inset-0 flex items-center justify-center"},Rt={class:"mt-4 text-white font-bold text-lg tracking-wide"},Ot=ge({__name:"ExpertViewFixed",setup(Pt){const{calcStarsValue:K}=je(),z=_(!1),W=_(""),x=me(),C=_(!1),le={Domingo:0,Lunes:1,Martes:2,Miercoles:3,Miércoles:3,Jueves:4,Viernes:5,Sabado:6,Sábado:6},A=ve(()=>{var n;const o=(n=s.value)==null?void 0:n.schedule,t=["Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],a={};return t.forEach(r=>{o!=null&&o[r]&&(a[r]=o[r])}),a}),J=he(),re=d(),ie=()=>re.getIsAuth?!0:(J.push("/login"),!1),v=_(null),de=()=>Object.values(A.value).flat(1).find(o=>o.takenBy==d().getUserUid&&!o.takenAt),Q=(o,t)=>{const a=le[o];if(a===void 0)throw new Error("Día inválido");const[n,r]=t.trim().split(":").map(Number),p=new Date,f=p.getDay(),h=a-f,b=new Date(p);return b.setDate(p.getDate()+h),b.setHours(n,r,0,0),b<=p&&b.setDate(b.getDate()+7),b},ee=o=>{const t=new Date,a=24*60*60*1e3;return o.getTime()-t.getTime()>=a},ce=(o,t)=>{if(E.value){x.warning("No puede agendar horarios si ya tiene citas agendadas");return}if(!ie())return;const a=A.value[o];if(!a)return;const n=a.find(f=>f.time===t);if(!n)return;if(n.isAvailable){x.warning("El horario de las ".concat(n.time," no está disponible"));return}if(n.takenBy!=null&&n.takenBy!=d().getUserUid){x.warning("El horario de las ".concat(n.time," ya está tomado por otro usuario"));return}if(n.takenBy==d().getUserUid&&n.takenAt!=null){x.warning("El horario de las ".concat(n.time," ya está tomado por usted"));return}let r;try{if(r=Q(o,n.time),!ee(r)){x.warning("No es posible agendar con menos de 24 horas de anticipación.");return}}catch(f){x.error("Error al calcular fecha de cita");return}const p=de();if(p&&p!==n&&(p.takenBy=null),n.takenBy==d().getUserUid)n.takenBy=null,v.value=null,H.value=null;else{n.takenBy=d().getUserUid,v.value=n;const f={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},h=r.toLocaleDateString("es-ES",f);H.value=h.charAt(0).toUpperCase()+h.slice(1)}},B=_e(),ue=async()=>{var f,h,b,N;if(!v.value){x.warning("No se ha seleccionado ningún horario");return}if((f=s.value)!=null&&f.isSuspended||(h=s.value)!=null&&h.isBanned){x.error("No puede agendar horarios con este experto.");return}if(E.value){x.error("Ya tiene una cita agendada.");return}const o=Object.keys(A.value).find(g=>A.value[g].includes(v.value));if(!o)return;const t=Q(o,v.value.time);if(!ee(t)){x.error("Mínimo 24 horas de anticipación requeridas.");return}z.value=!0,W.value="Asegurando tu cita...",C.value=!0;const a="".concat((b=s.value)==null?void 0:b.userUid,"_").concat(o,"_").concat(v.value.time),n=P(B,"bookings",a),r=P(B,"experts/".concat((N=s.value)==null?void 0:N.userUid)),p=P(Ce(B,"schedules"));try{await Ae(B,async g=>{var F,I,M,V,$;const L=await g.get(n),j=await g.get(r);if(L.exists())throw new Error("Este horario ya fue reservado.");if(!j.exists())throw new Error("El experto no existe.");const T=((F=j.data())==null?void 0:F.schedule)||{},w=(T[o]||[]).find(R=>R.time===v.value.time);if(!w||w.takenBy&&w.takenBy!==d().getUserUid)throw new Error("El horario ya no está disponible.");w.takenBy=d().getUserUid,w.takenAt=q.now(),g.set(n,{reserverUid:d().getUserUid,createdAt:q.now()}),g.update(r,{schedule:T}),g.set(p,{userName:d().getUserName,userUid:d().getUserUid,expertUid:(I=s.value)==null?void 0:I.userUid,expertName:(M=s.value)==null?void 0:M.fullName,expertSchedule:v.value,expertSpecialty:(V=s.value)==null?void 0:V.specialty,expertProfessionalId:($=s.value)==null?void 0:$.professionalId,appointmentLink:"",isFinished:!1,dayName:o,appointmentDate:q.fromDate(t),createdAt:q.now(),acceptedByExpert:!1})}),x.success("¡Cita agendada con éxito!"),setTimeout(()=>J.push("/appointments"),1500)}catch(g){x.error(g.message||"Error al agendar la cita."),C.value=!1,z.value=!1,v.value&&(v.value.takenBy=null)}},E=_(!1),G=_(""),H=_(null),pe=()=>{var t;const o=(t=s.value)==null?void 0:t.schedule;if(E.value=!1,G.value="",o)for(const[a,n]of Object.entries(o)){const r=n.find(p=>p.takenBy==d().getUserUid&&p.takenAt);if(r){E.value=!0,G.value="".concat(a," a las ").concat(r.time);break}}},X=_(!1),s=_(null);let Y;const xe=async()=>{const o=Ee().getExpertUid;if(!o)return X.value=!0,!1;const t=P(B,"experts/".concat(o));Y=Be(t,a=>{if(!a.exists()){x.error("No se encontró al experto");return}s.value=a.data(),pe(),X.value=!0})};we(async()=>{await xe(),Ne.init({blockHeadless:!0,publicKey:"8uRc3wp2ZXACkO_Eb"})}),ye(()=>{Y&&Y()});const te=o=>{if(!o)return!1;const t=d().getUserData;if(!(t!=null&&t.categoryConsultations))return!0;const a=t.categoryConsultations[o];return a?a.hasFreeConsult:!0},fe=Te(),se=()=>{s.value&&(fe.setExpertHiringData(s.value.fullName,s.value.specialty,s.value.userUid),J.push("/hiring"))};return(o,t)=>{var n,r,p,f,h,b,N,g,L,j,T,Z,w,F,I,M,V,$,R;const a=ke("v-icon");return l(),c("div",Ie,[e("main",Me,[X.value?(l(),c("div",$e,[m(oe,{"enter-active-class":"animate__animated animate__fadeInDown"},{default:ae(()=>{var O,U;return[te((O=s.value)==null?void 0:O.specialty)?S("",!0):(l(),c("div",He,[e("div",Le,[e("div",Re,[m(a,{name:"ri-error-warning-line",scale:"1.5",animation:"ring"})]),e("div",null,[t[3]||(t[3]=e("h4",{class:"text-blue-900 font-bold text-lg"},"Citas gratuitas agotadas",-1)),e("p",Oe,[t[1]||(t[1]=y(" Has completado tus citas gratuitas en la categoría ",-1)),e("span",Pe,u((U=s.value)==null?void 0:U.specialty),1),t[2]||(t[2]=y(". Contrata al experto para continuar con tu asesoría profesional. ",-1))])])]),e("button",{onClick:se,class:"w-full md:w-auto px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2 group"},[t[4]||(t[4]=e("span",null,"Contratar Ahora",-1)),m(a,{name:"bi-person-badge",class:"group-hover:translate-x-1 transition-transform"})])]))]}),_:1}),e("div",qe,[e("aside",ze,[e("div",Je,[e("div",Ge,[e("div",Xe,[t[5]||(t[5]=e("div",{class:"absolute z-10 bottom-0 opacity-0 group-hover:animate-fade-up group-hover:opacity-100 min-w-40 left-36 bg-white ring-[1px] ring-blue-500 text-blue-600 flex items-center justify-center rounded-lg p-2"},[e("p",{class:"text-xs font-quicksand"},"Este experto esta verificado por el equipo de Consulta Experto")],-1)),e("div",Ye,[e("img",{class:"w-full h-full object-cover",src:((n=s.value)==null?void 0:n.imgUrl)||"https://ui-avatars.com/api/?name="+((r=s.value)==null?void 0:r.fullName)+"&background=0D8ABC&color=fff",alt:(p=s.value)==null?void 0:p.fullName},null,8,Ze)]),m(a,{class:"absolute -bottom-2 -right-2 bg-blue-500 text-white w-10 h-10 p-1 rounded-full border-4 border-white shadow-sm",name:"ri-shield-check-fill",scale:"0.7"})]),e("h1",Ke,u((f=s.value)==null?void 0:f.fullName),1),e("p",We,u((h=s.value)==null?void 0:h.specialty),1),(b=s.value)!=null&&b.isSuspended?(l(),c("div",Qe,[m(a,{name:"ri-error-warning-line",scale:"0.8",class:"mr-1"}),t[6]||(t[6]=y(" Suspendido ",-1))])):S("",!0),e("div",et,[e("div",tt,[m(a,{name:"io-star",class:"text-yellow-500",scale:"1.1"}),e("span",st,u(k(K)((N=s.value)==null?void 0:N.rating).toFixed(1)),1)]),t[7]||(t[7]=e("div",{class:"h-4 w-px bg-slate-200"},null,-1)),e("span",at,u((L=(g=s.value)==null?void 0:g.rating)==null?void 0:L.count)+" Calificaciones",1)])]),e("div",ot,[e("div",nt,[t[8]||(t[8]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Cédula Profesional",-1)),e("span",lt,u(((j=s.value)==null?void 0:j.professionalId)||"No registrada"),1)]),e("div",rt,[t[9]||(t[9]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Años de Exp.",-1)),e("span",it,u(((T=s.value)==null?void 0:T.experienceYears)||"10+")+" años",1)]),e("div",dt,[t[10]||(t[10]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Cédula Profesional",-1)),e("span",ct,u(((Z=s.value)==null?void 0:Z.professionalId)||"No registrada"),1)]),e("div",ut,[t[11]||(t[11]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Resúmen",-1)),e("span",pt,u(((w=s.value)==null?void 0:w.bio)||"No registrado"),1)])])]),e("div",xt,[e("div",ft,[e("div",bt,u(((I=(F=s.value)==null?void 0:F.rating)==null?void 0:I.count)||0)+"+",1),t[12]||(t[12]=e("div",{class:"text-[10px] font-bold text-blue-600/70 uppercase"},"Consultas",-1))]),e("div",gt,[e("div",mt,u(k(K)((M=s.value)==null?void 0:M.rating).toFixed(1)),1),e("div",vt,"Extrellas ("+u(($=(V=s.value)==null?void 0:V.rating)==null?void 0:$.count)+" calificaciones)",1)])])]),e("section",ht,[e("div",_t,[e("div",wt,[e("div",yt,[e("div",kt,[m(a,{name:"bi-calendar-check"})]),t[13]||(t[13]=e("div",null,[e("h2",{class:"text-xl font-bold text-slate-800"},"Agenda de Citas"),e("p",{class:"text-slate-400 text-sm font-medium"},"Selecciona un horario disponible")],-1))]),E.value?(l(),c("div",Ut,[m(a,{class:"animate-bounce",name:"bi-calendar",scale:"1.4"}),e("span",St,"Tiene una cita agendada para el "+u(G.value),1)])):S("",!0)]),e("div",Dt,[te((R=s.value)==null?void 0:R.specialty)?(l(),c("div",Ct,[(l(!0),c(D,null,ne(A.value,(O,U)=>(l(),c("div",{key:U,class:"flex-shrink-0 w-48 space-y-4"},[e("div",At,u(U),1),e("div",Bt,[(l(!0),c(D,null,ne(O,(i,be)=>(l(),c("button",{key:be,onClick:qt=>ce(U,i.time),disabled:i.isAvailable||i.takenBy!=null&&i.takenBy!==k(d)().getUserUid,class:Se(["w-full py-3 px-2 rounded-2xl text-sm font-bold transition-all duration-300 transform active:scale-95 flex flex-col items-center gap-1",i.isAvailable?"bg-slate-50 text-slate-300 border border-slate-100 cursor-not-allowed":"",!i.isAvailable&&i.takenBy==null?"bg-white text-slate-700 border-2 border-slate-100 hover:border-blue-500 hover:text-blue-600":"",i.takenBy===k(d)().getUserUid&&!i.takenAt?"bg-blue-600 text-white border-blue-600 shadow-lg scale-[1.02]":"",i.takenBy===k(d)().getUserUid&&i.takenAt?"bg-green-500 text-white border-green-500 shadow-lg":"",i.takenBy!=null&&i.takenBy!==k(d)().getUserUid?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":""])},[y(u(i.time)+" ",1),e("span",Nt,[!i.isAvailable&&i.takenBy==null?(l(),c(D,{key:0},[y("Disponible")],64)):i.takenBy===k(d)().getUserUid?(l(),c(D,{key:1},[y("Seleccionado")],64)):i.takenBy!=null?(l(),c(D,{key:2},[y("Ocupado")],64)):(l(),c(D,{key:3},[y("Indisponible")],64))])],10,Et))),128))])]))),128))])):(l(),c("div",jt,[m(a,{name:"ri-user-smile-line",scale:"3",class:"text-slate-300 mb-4"}),t[14]||(t[14]=e("h3",{class:"text-lg font-bold text-slate-500"},"Ha agotado sus citas gratuitas para esta categoria ",-1)),t[15]||(t[15]=e("p",{class:"text-slate-400 max-w-xs mx-auto text-sm mt-2"},"Para poder continuar con una cita le recomendamos contratar al experto profesional.",-1)),e("button",{onClick:se,class:"mt-4 px-6 py-2 bg-blue-600 text-white font-bold rounded-2xl hover:bg-blue-700"},"Contratar")]))]),m(oe,{"enter-active-class":"animate__animated animate__fadeInUp","leave-active-class":"animate__animated animate__fadeOutDown"},{default:ae(()=>[H.value?(l(),c("div",Tt,[e("div",Ft,[e("div",It,[m(a,{name:"bi-calendar-check",scale:"1.2"})]),e("div",null,[t[16]||(t[16]=e("p",{class:"text-white/60 text-xs font-bold uppercase tracking-widest"},"Cita Seleccionada",-1)),e("h4",Mt,u(H.value),1)])]),e("button",{onClick:ue,disabled:C.value,class:"w-full md:w-auto px-10 py-4 bg-white text-blue-700 hover:bg-blue-50 font-extrabold rounded-2xl shadow-xl transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50"},[e("span",null,u(C.value?"Procesando...":"Confirmar Cita Ahora"),1),C.value?S("",!0):(l(),De(a,{key:0,name:"hi-paper-airplane"}))],8,Vt)])):S("",!0)]),_:1})])])])])):(l(),c("div",Ve,[...t[0]||(t[0]=[Ue('<div class="grid grid-cols-1 lg:grid-cols-12 gap-8" data-v-5cc0b2fc><div class="lg:col-span-4 bg-white rounded-3xl p-8 shadow-sm h-96" data-v-5cc0b2fc></div><div class="lg:col-span-8 space-y-6" data-v-5cc0b2fc><div class="bg-white rounded-3xl p-8 shadow-sm h-48" data-v-5cc0b2fc></div><div class="bg-white rounded-3xl p-8 shadow-sm h-96" data-v-5cc0b2fc></div></div></div>',1)])]))]),z.value?(l(),c("div",$t,[e("div",Ht,[t[17]||(t[17]=e("div",{class:"w-20 h-20 border-4 border-white/20 border-t-white rounded-full animate-spin"},null,-1)),e("div",Lt,[m(a,{name:"hi-paper-airplane",class:"text-white animate-pulse",scale:"1.5"})])]),e("p",Rt,u(W.value),1)])):S("",!0)])}}}),Kt=Fe(Ot,[["__scopeId","data-v-5cc0b2fc"]]);export{Kt as default};
