import{a as ve,k as _,u as he,$ as _e,i as we,L as d,j as ye,l as ke,m as Ue,r as ne,b as c,o as l,e,n as S,c as Se,f as x,w as X,g as w,t as u,Y as le,q as k,F as D,v as re,x as De,W as Ce,J as P,G as Ae,a5 as Be,V as q,a3 as Ee}from"./index-DNrVSXCL.js";import{u as Ne}from"./expertUi-BDeTuVt_.js";import{e as je}from"./index-DfBlkqaH.js";import{u as Te}from"./stars-B7JsDl3t.js";import{u as Fe}from"./hiring-DpHlfsiu.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"min-h-screen bg-[#F8FAFC] pb-10 font-manrope"},Ve={class:"px-4 sm:px-6 lg:px-8 pt-28 mt-5"},$e={key:0,class:"animate-pulse space-y-8"},Le={key:1,class:"space-y-2"},He={key:0,class:"bg-blue-50 border-l-4 border-blue-600 p-6 rounded-2xl shadow-sm flex flex-col md:flex-row items-center justify-between gap-6"},Re={class:"flex items-start gap-4"},Oe={class:"p-3 bg-blue-100 rounded-xl text-blue-600"},Pe={class:"text-blue-700 text-sm mt-1"},qe={class:"font-bold underline"},ze={class:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start"},Je={class:"lg:col-span-4 space-y-6"},Ye={class:"rounded-[2.5rem] shadow-xl shadow-slate-200/50 overflow-hidden border border-slate-100 group"},Ge={class:"p-8 text-center"},Ke={class:"relative group inline-block mb-6"},We={class:"w-32 h-32 rounded-[2rem] overflow-hidden ring-4 ring-offset-4 ring-blue-500 transition-all group-hover:scale-105"},Xe=["src","alt"],Ze={class:"text-2xl font-extrabold text-slate-800 tracking-tight"},Qe={class:"text-blue-600 font-semibold text-sm mt-1 uppercase tracking-wider"},et={key:0,class:"mt-2 inline-flex items-center px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs font-bold border border-red-100"},tt={class:"mt-6 flex items-center justify-center gap-2 bg-slate-50 rounded-2xl py-3 px-4"},st={class:"flex items-center gap-1"},at={class:"text-xl font-bold text-slate-800"},ot={class:"text-xs text-slate-500 font-medium"},nt={class:"border-t border-slate-100 bg-slate-50/50 p-6 space-y-4"},lt={class:"flex items-center justify-between"},rt={class:"text-sm font-semibold text-slate-700"},it={class:"flex items-center justify-between"},dt={class:"text-sm font-semibold text-slate-700"},ct={class:"flex items-center justify-between"},ut={class:"text-sm font-semibold text-slate-700"},pt={class:"flex items-center justify-between flex-col"},xt={class:"text-sm font-semibold text-slate-700"},bt={class:"bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100 grid grid-cols-2 gap-4"},ft={class:"p-4 bg-blue-50 rounded-2xl text-center"},gt={class:"text-2xl font-bold text-blue-700"},mt={class:"p-4 bg-blue-50 rounded-2xl text-center"},vt={class:"text-2xl font-bold text-blue-700"},ht={class:"text-[10px] font-bold text-blue-600/70 uppercase"},_t={class:"lg:col-span-8 space-y-8"},wt={class:"bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden"},yt={class:"p-8 pb-0 flex flex-col sm:flex-row sm:items-center justify-between gap-4"},kt={class:"flex items-center gap-3"},Ut={class:"p-2.5 bg-blue-600 rounded-xl text-white shadow-lg shadow-blue-200"},St={key:0,class:"flex items-center gap-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-xl border border-blue-100 ring-1 ring-blue-100"},Dt={class:"text-xs font-bold"},Ct={class:"ml-2 text-xs font-bold bg-blue-600 p-2 rounded-2xl text-white transition-colors flex items-center gap-1"},At={class:"p-4"},Bt={key:0,class:"flex overflow-x-auto gap-6 pb-2 scrollbar-hide"},Et={class:"text-center py-2 bg-slate-50 rounded-xl border border-slate-100 text-blue-700 font-bold text-sm"},Nt={class:"space-y-3"},jt=["onClick","disabled"],Tt={class:"text-[9px] uppercase tracking-widest opacity-80"},Ft={key:1,class:"text-center py-12 bg-slate-50 rounded-[2rem] border-2 border-dashed border-slate-200"},It={key:0,class:"bg-gradient-to-r from-blue-700 to-blue-700 p-6 flex flex-col md:flex-row items-center justify-between gap-6"},Mt={class:"flex items-center gap-4"},Vt={class:"p-3 bg-white/20 rounded-2xl text-white backdrop-blur-md"},$t={class:"text-white font-bold text-lg md:text-xl"},Lt=["disabled"],Ht={key:0,class:"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-blue-900/40 backdrop-blur-sm transition-all"},Rt={class:"relative"},Ot={class:"absolute inset-0 flex items-center justify-center"},Pt={class:"mt-4 text-white font-bold text-lg tracking-wide"},qt=ve({__name:"ExpertViewFixed",setup(zt){const{calcStarsValue:Z}=Te(),z=_(!1),Q=_(""),b=he(),C=_(!1),ie={Domingo:0,Lunes:1,Martes:2,Miercoles:3,Miércoles:3,Jueves:4,Viernes:5,Sabado:6,Sábado:6},A=_e(()=>{var n;const o=(n=s.value)==null?void 0:n.schedule,t=["Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],a={};return t.forEach(r=>{o!=null&&o[r]&&(a[r]=o[r])}),a}),J=we(),de=d(),ce=()=>de.getIsAuth?!0:(J.push("/login"),!1),v=_(null),ue=()=>Object.values(A.value).flat(1).find(o=>o.takenBy==d().getUserUid&&!o.takenAt),ee=(o,t)=>{const a=ie[o];if(a===void 0)throw new Error("Día inválido");const[n,r]=t.trim().split(":").map(Number),p=new Date,f=p.getDay(),h=a-f,g=new Date(p);return g.setDate(p.getDate()+h),g.setHours(n,r,0,0),g<=p&&g.setDate(g.getDate()+7),g},te=o=>{const t=new Date,a=24*60*60*1e3;return o.getTime()-t.getTime()>=a},pe=(o,t)=>{if(E.value){b.warning("No puede agendar horarios si ya tiene citas agendadas");return}if(!ce())return;const a=A.value[o];if(!a)return;const n=a.find(f=>f.time===t);if(!n)return;if(n.isAvailable){b.warning("El horario de las ".concat(n.time," no está disponible"));return}if(n.takenBy!=null&&n.takenBy!=d().getUserUid){b.warning("El horario de las ".concat(n.time," ya está tomado por otro usuario"));return}if(n.takenBy==d().getUserUid&&n.takenAt!=null){b.warning("El horario de las ".concat(n.time," ya está tomado por usted"));return}let r;try{if(r=ee(o,n.time),!te(r)){b.warning("No es posible agendar con menos de 24 horas de anticipación.");return}}catch(f){b.error("Error al calcular fecha de cita");return}const p=ue();if(p&&p!==n&&(p.takenBy=null),n.takenBy==d().getUserUid)n.takenBy=null,v.value=null,L.value=null;else{n.takenBy=d().getUserUid,v.value=n;const f={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},h=r.toLocaleDateString("es-ES",f);L.value=h.charAt(0).toUpperCase()+h.slice(1)}},B=ye(),xe=async()=>{var f,h,g,N;if(!v.value){b.warning("No se ha seleccionado ningún horario");return}if((f=s.value)!=null&&f.isSuspended||(h=s.value)!=null&&h.isBanned){b.error("No puede agendar horarios con este experto.");return}if(E.value){b.error("Ya tiene una cita agendada.");return}const o=Object.keys(A.value).find(m=>A.value[m].includes(v.value));if(!o)return;const t=ee(o,v.value.time);if(!te(t)){b.error("Mínimo 24 horas de anticipación requeridas.");return}z.value=!0,Q.value="Asegurando tu cita...",C.value=!0;const a="".concat((g=s.value)==null?void 0:g.userUid,"_").concat(o,"_").concat(v.value.time),n=P(B,"bookings",a),r=P(B,"experts/".concat((N=s.value)==null?void 0:N.userUid)),p=P(Ae(B,"schedules"));try{await Be(B,async m=>{var F,I,M,V,$;const H=await m.get(n),j=await m.get(r);if(H.exists())throw new Error("Este horario ya fue reservado.");if(!j.exists())throw new Error("El experto no existe.");const T=((F=j.data())==null?void 0:F.schedule)||{},y=(T[o]||[]).find(R=>R.time===v.value.time);if(!y||y.takenBy&&y.takenBy!==d().getUserUid)throw new Error("El horario ya no está disponible.");y.takenBy=d().getUserUid,y.takenAt=q.now(),m.set(n,{reserverUid:d().getUserUid,createdAt:q.now()}),m.update(r,{schedule:T}),m.set(p,{userName:d().getUserName,userUid:d().getUserUid,expertUid:(I=s.value)==null?void 0:I.userUid,expertName:(M=s.value)==null?void 0:M.fullName,expertSchedule:v.value,expertSpecialty:(V=s.value)==null?void 0:V.specialty,expertProfessionalId:($=s.value)==null?void 0:$.professionalId,appointmentLink:"",isFinished:!1,dayName:o,appointmentDate:q.fromDate(t),createdAt:q.now(),acceptedByExpert:!1})}),b.success("¡Cita agendada con éxito!"),setTimeout(()=>J.push("/appointments"),1500)}catch(m){b.error(m.message||"Error al agendar la cita."),C.value=!1,z.value=!1,v.value&&(v.value.takenBy=null)}},E=_(!1),Y=_(""),L=_(null),be=()=>{var t;const o=(t=s.value)==null?void 0:t.schedule;if(E.value=!1,Y.value="",o)for(const[a,n]of Object.entries(o)){const r=n.find(p=>p.takenBy==d().getUserUid&&p.takenAt);if(r){E.value=!0,Y.value="".concat(a," a las ").concat(r.time);break}}},G=_(!1),s=_(null);let K;const fe=async()=>{const o=Ne().getExpertUid;if(!o)return G.value=!0,!1;const t=P(B,"experts/".concat(o));K=Ee(t,a=>{if(!a.exists()){b.error("No se encontró al experto");return}s.value=a.data(),be(),G.value=!0})};ke(async()=>{await fe(),je.init({blockHeadless:!0,publicKey:"8uRc3wp2ZXACkO_Eb"})}),Ue(()=>{K&&K()});const se=o=>{if(!o)return!1;const t=d().getUserData;if(!(t!=null&&t.categoryConsultations))return!0;const a=t.categoryConsultations[o];return a?a.hasFreeConsult:!0},ge=Fe(),ae=()=>{s.value&&(ge.setExpertHiringData(s.value.fullName,s.value.specialty,s.value.userUid),J.push("/hiring"))};return(o,t)=>{var r,p,f,h,g,N,m,H,j,T,W,y,F,I,M,V,$,R,oe;const a=ne("v-icon"),n=ne("RouterLink");return l(),c("div",Me,[e("main",Ve,[G.value?(l(),c("div",Le,[x(le,{"enter-active-class":"animate__animated animate__fadeInDown"},{default:X(()=>{var O,U;return[se((O=s.value)==null?void 0:O.specialty)?S("",!0):(l(),c("div",He,[e("div",Re,[e("div",Oe,[x(a,{name:"ri-error-warning-line",scale:"1.5",animation:"ring"})]),e("div",null,[t[3]||(t[3]=e("h4",{class:"text-blue-900 font-bold text-lg"},"Citas gratuitas agotadas",-1)),e("p",Pe,[t[1]||(t[1]=w(" Has completado tus citas gratuitas en la categoría ",-1)),e("span",qe,u((U=s.value)==null?void 0:U.specialty),1),t[2]||(t[2]=w(". Contrata al experto para continuar con tu asesoría profesional. ",-1))])])]),e("button",{onClick:ae,class:"w-full md:w-auto px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2 group"},[t[4]||(t[4]=e("span",null,"Contratar Ahora",-1)),x(a,{name:"bi-person-badge",class:"group-hover:translate-x-1 transition-transform"})])]))]}),_:1}),e("div",ze,[e("aside",Je,[e("div",Ye,[e("div",Ge,[e("div",Ke,[t[5]||(t[5]=e("div",{class:"absolute z-10 bottom-0 opacity-0 group-hover:animate-fade-up group-hover:opacity-100 min-w-40 left-36 bg-white ring-[1px] ring-blue-500 text-blue-600 flex items-center justify-center rounded-lg p-2"},[e("p",{class:"text-xs font-quicksand"},"Este experto esta verificado por el equipo de Consulta Experto")],-1)),e("div",We,[e("img",{class:"w-full h-full object-cover",src:((r=s.value)==null?void 0:r.imgUrl)||"https://ui-avatars.com/api/?name="+((p=s.value)==null?void 0:p.fullName)+"&background=0D8ABC&color=fff",alt:(f=s.value)==null?void 0:f.fullName},null,8,Xe)]),x(a,{class:"absolute -bottom-2 -right-2 bg-blue-500 text-white w-10 h-10 p-1 rounded-full border-4 border-white shadow-sm",name:"ri-shield-check-fill",scale:"0.7"})]),e("h1",Ze,u((h=s.value)==null?void 0:h.fullName),1),e("p",Qe,u((g=s.value)==null?void 0:g.specialty),1),(N=s.value)!=null&&N.isSuspended?(l(),c("div",et,[x(a,{name:"ri-error-warning-line",scale:"0.8",class:"mr-1"}),t[6]||(t[6]=w(" Suspendido ",-1))])):S("",!0),e("div",tt,[e("div",st,[x(a,{name:"io-star",class:"text-yellow-500",scale:"1.1"}),e("span",at,u(k(Z)((m=s.value)==null?void 0:m.rating).toFixed(1)),1)]),t[7]||(t[7]=e("div",{class:"h-4 w-px bg-slate-200"},null,-1)),e("span",ot,u((j=(H=s.value)==null?void 0:H.rating)==null?void 0:j.count)+" Calificaciones",1)])]),e("div",nt,[e("div",lt,[t[8]||(t[8]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Cédula Profesional",-1)),e("span",rt,u(((T=s.value)==null?void 0:T.professionalId)||"No registrada"),1)]),e("div",it,[t[9]||(t[9]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Años de Exp.",-1)),e("span",dt,u(((W=s.value)==null?void 0:W.experienceYears)||"10+")+" años",1)]),e("div",ct,[t[10]||(t[10]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Cédula Profesional",-1)),e("span",ut,u(((y=s.value)==null?void 0:y.professionalId)||"No registrada"),1)]),e("div",pt,[t[11]||(t[11]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Resúmen",-1)),e("span",xt,u(((F=s.value)==null?void 0:F.bio)||"No registrado"),1)])])]),e("div",bt,[e("div",ft,[e("div",gt,u(((M=(I=s.value)==null?void 0:I.rating)==null?void 0:M.count)||0)+"+",1),t[12]||(t[12]=e("div",{class:"text-[10px] font-bold text-blue-600/70 uppercase"},"Consultas",-1))]),e("div",mt,[e("div",vt,u(k(Z)((V=s.value)==null?void 0:V.rating).toFixed(1)),1),e("div",ht,"Extrellas ("+u((R=($=s.value)==null?void 0:$.rating)==null?void 0:R.count)+" calificaciones)",1)])])]),e("section",_t,[e("div",wt,[e("div",yt,[e("div",kt,[e("div",Ut,[x(a,{name:"bi-calendar-check"})]),t[13]||(t[13]=e("div",null,[e("h2",{class:"text-xl font-bold text-slate-800"},"Agenda de Citas"),e("p",{class:"text-slate-400 text-sm font-medium"},"Selecciona un horario disponible")],-1))]),E.value?(l(),c("div",St,[x(a,{class:"animate-bounce",name:"bi-calendar",scale:"1.4"}),e("span",Dt,"Tiene una cita agendada para el "+u(Y.value),1),x(n,{to:"/client-appointments"},{default:X(()=>[e("button",Ct,[t[14]||(t[14]=w("Ver citas ",-1)),x(a,{name:"bi-arrow-right",scale:"1"})])]),_:1})])):S("",!0)]),e("div",At,[se((oe=s.value)==null?void 0:oe.specialty)?(l(),c("div",Bt,[(l(!0),c(D,null,re(A.value,(O,U)=>(l(),c("div",{key:U,class:"flex-shrink-0 w-48 space-y-4"},[e("div",Et,u(U),1),e("div",Nt,[(l(!0),c(D,null,re(O,(i,me)=>(l(),c("button",{key:me,onClick:Jt=>pe(U,i.time),disabled:i.isAvailable||i.takenBy!=null&&i.takenBy!==k(d)().getUserUid,class:De(["w-full py-3 px-2 rounded-2xl text-sm font-bold transition-all duration-300 transform active:scale-95 flex flex-col items-center gap-1",i.isAvailable?"bg-slate-50 text-slate-300 border border-slate-100 cursor-not-allowed":"",!i.isAvailable&&i.takenBy==null?"bg-white text-slate-700 border-2 border-slate-100 hover:border-blue-500 hover:text-blue-600":"",i.takenBy===k(d)().getUserUid&&!i.takenAt?"bg-blue-600 text-white border-blue-600 shadow-lg scale-[1.02]":"",i.takenBy===k(d)().getUserUid&&i.takenAt?"bg-green-500 text-white border-green-500 shadow-lg":"",i.takenBy!=null&&i.takenBy!==k(d)().getUserUid?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":""])},[w(u(i.time)+" ",1),e("span",Tt,[!i.isAvailable&&i.takenBy==null?(l(),c(D,{key:0},[w("Disponible")],64)):i.takenBy===k(d)().getUserUid?(l(),c(D,{key:1},[w("Seleccionado")],64)):i.takenBy!=null?(l(),c(D,{key:2},[w("Ocupado")],64)):(l(),c(D,{key:3},[w("Indisponible")],64))])],10,jt))),128))])]))),128))])):(l(),c("div",Ft,[x(a,{name:"ri-user-smile-line",scale:"3",class:"text-slate-300 mb-4"}),t[15]||(t[15]=e("h3",{class:"text-lg font-bold text-slate-500"},"Ha agotado sus citas gratuitas para esta categoria ",-1)),t[16]||(t[16]=e("p",{class:"text-slate-400 max-w-xs mx-auto text-sm mt-2"},"Para poder continuar con una cita le recomendamos contratar al experto profesional.",-1)),e("button",{onClick:ae,class:"mt-4 px-6 py-2 bg-blue-600 text-white font-bold rounded-2xl hover:bg-blue-700"},"Contratar")]))]),x(le,{"enter-active-class":"animate__animated animate__fadeInUp","leave-active-class":"animate__animated animate__fadeOutDown"},{default:X(()=>[L.value?(l(),c("div",It,[e("div",Mt,[e("div",Vt,[x(a,{name:"bi-calendar-check",scale:"1.2"})]),e("div",null,[t[17]||(t[17]=e("p",{class:"text-white/60 text-xs font-bold uppercase tracking-widest"},"Cita Seleccionada",-1)),e("h4",$t,u(L.value),1)])]),e("button",{onClick:xe,disabled:C.value,class:"w-full md:w-auto px-10 py-4 bg-white text-blue-700 hover:bg-blue-50 font-extrabold rounded-2xl shadow-xl transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50"},[e("span",null,u(C.value?"Procesando...":"Confirmar Cita Ahora"),1),C.value?S("",!0):(l(),Ce(a,{key:0,name:"hi-paper-airplane"}))],8,Lt)])):S("",!0)]),_:1})])])])])):(l(),c("div",$e,[...t[0]||(t[0]=[Se('<div class="grid grid-cols-1 lg:grid-cols-12 gap-8" data-v-cb52ce31><div class="lg:col-span-4 bg-white rounded-3xl p-8 shadow-sm h-96" data-v-cb52ce31></div><div class="lg:col-span-8 space-y-6" data-v-cb52ce31><div class="bg-white rounded-3xl p-8 shadow-sm h-48" data-v-cb52ce31></div><div class="bg-white rounded-3xl p-8 shadow-sm h-96" data-v-cb52ce31></div></div></div>',1)])]))]),z.value?(l(),c("div",Ht,[e("div",Rt,[t[18]||(t[18]=e("div",{class:"w-20 h-20 border-4 border-white/20 border-t-white rounded-full animate-spin"},null,-1)),e("div",Ot,[x(a,{name:"hi-paper-airplane",class:"text-white animate-pulse",scale:"1.5"})])]),e("p",Pt,u(Q.value),1)])):S("",!0)])}}}),Qt=Ie(qt,[["__scopeId","data-v-cb52ce31"]]);export{Qt as default};
