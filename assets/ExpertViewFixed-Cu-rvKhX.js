import{a as pe,k as _,u as xe,Z as be,i as ge,L as d,j as fe,l as me,m as ve,r as he,b as c,o as r,e,n as S,c as we,f as m,w as W,g as k,t as p,X as Q,q as D,F as C,v as ee,x as _e,W as ye,J as $,G as ke,a4 as Ue,V as H,a2 as Se}from"./index-BYM5y-Co.js";import{u as De}from"./expertUi-B9qsdSyo.js";import{e as Ce}from"./index-DfBlkqaH.js";import{u as Ae}from"./stars-B7JsDl3t.js";import{u as Be}from"./hiring-svkLgzEa.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"min-h-screen bg-[#F8FAFC] pb-10 font-manrope"},je={class:"px-4 sm:px-6 lg:px-8 pt-28 mt-5"},Te={key:0,class:"animate-pulse space-y-8"},Fe={key:1,class:"space-y-2"},Me={key:0,class:"bg-blue-50 border-l-4 border-blue-600 p-6 rounded-2xl shadow-sm flex flex-col md:flex-row items-center justify-between gap-6"},Ve={class:"flex items-start gap-4"},Ie={class:"p-3 bg-blue-100 rounded-xl text-blue-600"},$e={class:"text-blue-700 text-sm mt-1"},He={class:"font-bold underline"},Le={class:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start"},Oe={class:"lg:col-span-4 space-y-6"},Pe={class:"bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/50 overflow-hidden border border-slate-100 group"},Re={class:"p-8 text-center"},Je={class:"relative inline-block mb-6"},qe={class:"w-32 h-32 rounded-[2rem] overflow-hidden ring-4 ring-offset-4 ring-blue-500 transition-all group-hover:scale-105"},ze=["src","alt"],Ge={class:"text-2xl font-extrabold text-slate-800 tracking-tight"},Xe={class:"text-blue-600 font-semibold text-sm mt-1 uppercase tracking-wider"},Ye={key:0,class:"mt-2 inline-flex items-center px-3 py-1 rounded-full bg-red-50 text-red-600 text-xs font-bold border border-red-100"},Ze={class:"mt-6 flex items-center justify-center gap-2 bg-slate-50 rounded-2xl py-3 px-4"},Ke={class:"flex items-center gap-1"},We={class:"text-xl font-bold text-slate-800"},Qe={class:"text-xs text-slate-500 font-medium"},et={class:"border-t border-slate-100 bg-slate-50/50 p-6 space-y-4"},tt={class:"flex items-center justify-between"},st={class:"text-sm font-semibold text-slate-700"},at={class:"flex items-center justify-between"},ot={class:"text-sm font-semibold text-slate-700"},nt={class:"bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100 grid grid-cols-2 gap-4"},lt={class:"p-4 bg-blue-50 rounded-2xl text-center"},rt={class:"text-2xl font-bold text-blue-700"},it={class:"lg:col-span-8 space-y-8"},dt={class:"bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden"},ct={class:"p-8 pb-0 flex flex-col sm:flex-row sm:items-center justify-between gap-4"},ut={class:"flex items-center gap-3"},pt={class:"p-2.5 bg-blue-600 rounded-xl text-white shadow-lg shadow-blue-200"},xt={key:0,class:"flex items-center gap-2 bg-blue-50 text-blue-700 px-4 py-2 rounded-xl border border-blue-100 ring-1 ring-blue-100"},bt={class:"text-xs font-bold"},gt={class:"p-4"},ft={key:0,class:"flex overflow-x-auto gap-6 pb-2 scrollbar-hide"},mt={class:"text-center py-2 bg-slate-50 rounded-xl border border-slate-100 text-blue-700 font-bold text-sm"},vt={class:"space-y-3"},ht=["onClick","disabled"],wt={class:"text-[9px] uppercase tracking-widest opacity-80"},_t={key:1,class:"text-center py-12 bg-slate-50 rounded-[2rem] border-2 border-dashed border-slate-200"},yt={key:0,class:"bg-gradient-to-r from-blue-700 to-blue-700 p-6 flex flex-col md:flex-row items-center justify-between gap-6"},kt={class:"flex items-center gap-4"},Ut={class:"p-3 bg-white/20 rounded-2xl text-white backdrop-blur-md"},St={class:"text-white font-bold text-lg md:text-xl"},Dt=["disabled"],Ct={key:0,class:"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-blue-900/40 backdrop-blur-sm transition-all"},At={class:"relative"},Bt={class:"absolute inset-0 flex items-center justify-center"},Et={class:"mt-4 text-white font-bold text-lg tracking-wide"},Nt=pe({__name:"ExpertViewFixed",setup(jt){const{calcStarsValue:te}=Ae(),L=_(!1),G=_(""),x=xe(),A=_(!1),se={Domingo:0,Lunes:1,Martes:2,Miercoles:3,Miércoles:3,Jueves:4,Viernes:5,Sabado:6,Sábado:6},B=be(()=>{var n;const a=(n=o.value)==null?void 0:n.schedule,t=["Lunes","Martes","Miercoles","Jueves","Viernes","Sábado"],s={};return t.forEach(i=>{a!=null&&a[i]&&(s[i]=a[i])}),s}),O=ge(),ae=d(),oe=()=>ae.getIsAuth?!0:(O.push("/login"),!1),v=_(null),ne=()=>Object.values(B.value).flat(1).find(a=>a.takenBy==d().getUserUid&&!a.takenAt),X=(a,t)=>{const s=se[a];if(s===void 0)throw new Error("Día inválido");const[n,i]=t.trim().split(":").map(Number),u=new Date,b=u.getDay(),h=s-b,g=new Date(u);return g.setDate(u.getDate()+h),g.setHours(n,i,0,0),g<=u&&g.setDate(g.getDate()+7),g},Y=a=>{const t=new Date,s=24*60*60*1e3;return a.getTime()-t.getTime()>=s},le=(a,t)=>{if(N.value){x.warning("No puede agendar horarios si ya tiene citas agendadas");return}if(!oe())return;const s=B.value[a];if(!s)return;const n=s.find(b=>b.time===t);if(!n)return;if(n.isAvailable){x.warning("El horario de las ".concat(n.time," no está disponible"));return}if(n.takenBy!=null&&n.takenBy!=d().getUserUid){x.warning("El horario de las ".concat(n.time," ya está tomado por otro usuario"));return}if(n.takenBy==d().getUserUid&&n.takenAt!=null){x.warning("El horario de las ".concat(n.time," ya está tomado por usted"));return}let i;try{if(i=X(a,n.time),!Y(i)){x.warning("No es posible agendar con menos de 24 horas de anticipación.");return}}catch(b){x.error("Error al calcular fecha de cita");return}const u=ne();if(u&&u!==n&&(u.takenBy=null),n.takenBy==d().getUserUid)n.takenBy=null,v.value=null,M.value=null;else{n.takenBy=d().getUserUid,v.value=n;const b={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"},h=i.toLocaleDateString("es-ES",b);M.value=h.charAt(0).toUpperCase()+h.slice(1)}},E=fe(),re=async()=>{var b,h,g,j;if(!v.value){x.warning("No se ha seleccionado ningún horario");return}if((b=o.value)!=null&&b.isSuspended||(h=o.value)!=null&&h.isBanned){x.error("No puede agendar horarios con este experto.");return}if(N.value){x.error("Ya tiene una cita agendada.");return}const a=Object.keys(B.value).find(f=>B.value[f].includes(v.value));if(!a)return;const t=X(a,v.value.time);if(!Y(t)){x.error("Mínimo 24 horas de anticipación requeridas.");return}L.value=!0,G.value="Asegurando tu cita...",A.value=!0;const s="".concat((g=o.value)==null?void 0:g.userUid,"_").concat(a,"_").concat(v.value.time),n=$(E,"bookings",s),i=$(E,"experts/".concat((j=o.value)==null?void 0:j.userUid)),u=$(ke(E,"schedules"));try{await Ue(E,async f=>{var U,w,l,I,z;const V=await f.get(n),T=await f.get(i);if(V.exists())throw new Error("Este horario ya fue reservado.");if(!T.exists())throw new Error("El experto no existe.");const F=((U=T.data())==null?void 0:U.schedule)||{},y=(F[a]||[]).find(ue=>ue.time===v.value.time);if(!y||y.takenBy&&y.takenBy!==d().getUserUid)throw new Error("El horario ya no está disponible.");y.takenBy=d().getUserUid,y.takenAt=H.now(),f.set(n,{reserverUid:d().getUserUid,createdAt:H.now()}),f.update(i,{schedule:F}),f.set(u,{userName:d().getUserName,userUid:d().getUserUid,expertUid:(w=o.value)==null?void 0:w.userUid,expertName:(l=o.value)==null?void 0:l.fullName,expertSchedule:v.value,expertSpecialty:(I=o.value)==null?void 0:I.specialty,expertProfessionalId:(z=o.value)==null?void 0:z.professionalId,appointmentLink:"",isFinished:!1,dayName:a,appointmentDate:H.fromDate(t),createdAt:H.now(),acceptedByExpert:!1})}),x.success("¡Cita agendada con éxito!"),setTimeout(()=>O.push("/appointments"),1500)}catch(f){x.error(f.message||"Error al agendar la cita."),A.value=!1,L.value=!1,v.value&&(v.value.takenBy=null)}},N=_(!1),P=_(""),M=_(null),ie=()=>{var t;const a=(t=o.value)==null?void 0:t.schedule;if(N.value=!1,P.value="",a)for(const[s,n]of Object.entries(a)){const i=n.find(u=>u.takenBy==d().getUserUid&&u.takenAt);if(i){N.value=!0,P.value="".concat(s," a las ").concat(i.time);break}}},R=_(!1),o=_(null);let J;const de=async()=>{const a=De().getExpertUid;if(!a)return R.value=!0,!1;const t=$(E,"experts/".concat(a));J=Se(t,s=>{if(!s.exists()){x.error("No se encontró al experto");return}o.value=s.data(),ie(),R.value=!0})};me(async()=>{await de(),Ce.init({blockHeadless:!0,publicKey:"8uRc3wp2ZXACkO_Eb"})}),ve(()=>{J&&J()});const Z=a=>{if(!a)return!1;const t=d().getUserData;if(!(t!=null&&t.categoryConsultations))return!0;const s=t.categoryConsultations[a];return s?s.hasFreeConsult:!0},ce=Be(),K=()=>{o.value&&(ce.setExpertHiringData(o.value.fullName,o.value.specialty,o.value.userUid),O.push("/hiring"))};return(a,t)=>{var n,i,u,b,h,g,j,f,V,T,F,q,y;const s=he("v-icon");return r(),c("div",Ne,[e("main",je,[R.value?(r(),c("div",Fe,[m(Q,{"enter-active-class":"animate__animated animate__fadeInDown"},{default:W(()=>{var U,w;return[Z((U=o.value)==null?void 0:U.specialty)?S("",!0):(r(),c("div",Me,[e("div",Ve,[e("div",Ie,[m(s,{name:"ri-error-warning-line",scale:"1.5",animation:"ring"})]),e("div",null,[t[3]||(t[3]=e("h4",{class:"text-blue-900 font-bold text-lg"},"Citas gratuitas agotadas",-1)),e("p",$e,[t[1]||(t[1]=k(" Has completado tus citas gratuitas en la categoría ",-1)),e("span",He,p((w=o.value)==null?void 0:w.specialty),1),t[2]||(t[2]=k(". Contrata al experto para continuar con tu asesoría profesional. ",-1))])])]),e("button",{onClick:K,class:"w-full md:w-auto px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-2xl shadow-lg shadow-blue-200 transition-all flex items-center justify-center gap-2 group"},[t[4]||(t[4]=e("span",null,"Contratar Ahora",-1)),m(s,{name:"bi-person-badge",class:"group-hover:translate-x-1 transition-transform"})])]))]}),_:1}),e("div",Le,[e("aside",Oe,[e("div",Pe,[e("div",Re,[e("div",Je,[e("div",qe,[e("img",{class:"w-full h-full object-cover",src:((n=o.value)==null?void 0:n.profilePicture)||"https://ui-avatars.com/api/?name="+((i=o.value)==null?void 0:i.fullName)+"&background=0D8ABC&color=fff",alt:(u=o.value)==null?void 0:u.fullName},null,8,ze)]),t[5]||(t[5]=e("div",{class:"absolute -bottom-2 -right-2 bg-green-500 w-8 h-8 rounded-full border-4 border-white shadow-sm",title:"Expert Verified"},null,-1))]),e("h1",Ge,p((b=o.value)==null?void 0:b.fullName),1),e("p",Xe,p((h=o.value)==null?void 0:h.specialty),1),(g=o.value)!=null&&g.isSuspended?(r(),c("div",Ye,[m(s,{name:"ri-error-warning-line",scale:"0.8",class:"mr-1"}),t[6]||(t[6]=k(" Suspendido ",-1))])):S("",!0),e("div",Ze,[e("div",Ke,[m(s,{name:"io-star",class:"text-yellow-500",scale:"1.1"}),e("span",We,p(D(te)((j=o.value)==null?void 0:j.rating).toFixed(1)),1)]),t[7]||(t[7]=e("div",{class:"h-4 w-px bg-slate-200"},null,-1)),e("span",Qe,p((V=(f=o.value)==null?void 0:f.rating)==null?void 0:V.count)+" Calificaciones",1)])]),e("div",et,[e("div",tt,[t[8]||(t[8]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Cédula Profesional",-1)),e("span",st,p(((T=o.value)==null?void 0:T.professionalId)||"No registrada"),1)]),e("div",at,[t[9]||(t[9]=e("span",{class:"text-xs font-bold text-slate-400 uppercase"},"Años de Exp.",-1)),e("span",ot,p(((F=o.value)==null?void 0:F.experienceYears)||"10+")+" años",1)])])]),e("div",nt,[e("div",lt,[e("div",rt,p(((q=o.value)==null?void 0:q.completedSessions)||120)+"+",1),t[10]||(t[10]=e("div",{class:"text-[10px] font-bold text-blue-600/70 uppercase"},"Consultas",-1))]),t[11]||(t[11]=e("div",{class:"p-4 bg-blue-50 rounded-2xl text-center"},[e("div",{class:"text-2xl font-bold text-blue-700"},"98%"),e("div",{class:"text-[10px] font-bold text-blue-600/70 uppercase"},"Éxito")],-1))])]),e("section",it,[e("div",dt,[e("div",ct,[e("div",ut,[e("div",pt,[m(s,{name:"bi-calendar-check"})]),t[12]||(t[12]=e("div",null,[e("h2",{class:"text-xl font-bold text-slate-800"},"Agenda de Citas"),e("p",{class:"text-slate-400 text-sm font-medium"},"Selecciona un horario disponible")],-1))]),N.value?(r(),c("div",xt,[m(s,{class:"animate-bounce",name:"bi-calendar",scale:"1.4"}),e("span",bt,"Tiene una cita agendada para el "+p(P.value),1)])):S("",!0)]),e("div",gt,[Z((y=o.value)==null?void 0:y.specialty)?(r(),c("div",ft,[(r(!0),c(C,null,ee(B.value,(U,w)=>(r(),c("div",{key:w,class:"flex-shrink-0 w-48 space-y-4"},[e("div",mt,p(w),1),e("div",vt,[(r(!0),c(C,null,ee(U,(l,I)=>(r(),c("button",{key:I,onClick:z=>le(w,l.time),disabled:l.isAvailable||l.takenBy!=null&&l.takenBy!==D(d)().getUserUid,class:_e(["w-full py-3 px-2 rounded-2xl text-sm font-bold transition-all duration-300 transform active:scale-95 flex flex-col items-center gap-1",l.isAvailable?"bg-slate-50 text-slate-300 border border-slate-100 cursor-not-allowed":"",!l.isAvailable&&l.takenBy==null?"bg-white text-slate-700 border-2 border-slate-100 hover:border-blue-500 hover:text-blue-600":"",l.takenBy===D(d)().getUserUid&&!l.takenAt?"bg-blue-600 text-white border-blue-600 shadow-lg scale-[1.02]":"",l.takenBy===D(d)().getUserUid&&l.takenAt?"bg-green-500 text-white border-green-500 shadow-lg":"",l.takenBy!=null&&l.takenBy!==D(d)().getUserUid?"bg-slate-100 text-slate-400 border-slate-200 cursor-not-allowed":""])},[k(p(l.time)+" ",1),e("span",wt,[!l.isAvailable&&l.takenBy==null?(r(),c(C,{key:0},[k("Disponible")],64)):l.takenBy===D(d)().getUserUid?(r(),c(C,{key:1},[k("Seleccionado")],64)):l.takenBy!=null?(r(),c(C,{key:2},[k("Ocupado")],64)):(r(),c(C,{key:3},[k("Indisponible")],64))])],10,ht))),128))])]))),128))])):(r(),c("div",_t,[m(s,{name:"ri-user-smile-line",scale:"3",class:"text-slate-300 mb-4"}),t[13]||(t[13]=e("h3",{class:"text-lg font-bold text-slate-500"},"Ha agotado sus citas gratuitas para esta categoria ",-1)),t[14]||(t[14]=e("p",{class:"text-slate-400 max-w-xs mx-auto text-sm mt-2"},"Para poder continuar con una cita le recomendamos contratar al experto profesional.",-1)),e("button",{onClick:K,class:"mt-4 px-6 py-2 bg-blue-600 text-white font-bold rounded-2xl hover:bg-blue-700"},"Contratar")]))]),m(Q,{"enter-active-class":"animate__animated animate__fadeInUp","leave-active-class":"animate__animated animate__fadeOutDown"},{default:W(()=>[M.value?(r(),c("div",yt,[e("div",kt,[e("div",Ut,[m(s,{name:"bi-calendar-check",scale:"1.2"})]),e("div",null,[t[15]||(t[15]=e("p",{class:"text-white/60 text-xs font-bold uppercase tracking-widest"},"Cita Seleccionada",-1)),e("h4",St,p(M.value),1)])]),e("button",{onClick:re,disabled:A.value,class:"w-full md:w-auto px-10 py-4 bg-white text-blue-700 hover:bg-blue-50 font-extrabold rounded-2xl shadow-xl transition-all flex items-center justify-center gap-3 active:scale-95 disabled:opacity-50"},[e("span",null,p(A.value?"Procesando...":"Confirmar Cita Ahora"),1),A.value?S("",!0):(r(),ye(s,{key:0,name:"hi-paper-airplane"}))],8,Dt)])):S("",!0)]),_:1})])])])])):(r(),c("div",Te,[...t[0]||(t[0]=[we('<div class="grid grid-cols-1 lg:grid-cols-12 gap-8" data-v-49004d2c><div class="lg:col-span-4 bg-white rounded-3xl p-8 shadow-sm h-96" data-v-49004d2c></div><div class="lg:col-span-8 space-y-6" data-v-49004d2c><div class="bg-white rounded-3xl p-8 shadow-sm h-48" data-v-49004d2c></div><div class="bg-white rounded-3xl p-8 shadow-sm h-96" data-v-49004d2c></div></div></div>',1)])]))]),L.value?(r(),c("div",Ct,[e("div",At,[t[16]||(t[16]=e("div",{class:"w-20 h-20 border-4 border-white/20 border-t-white rounded-full animate-spin"},null,-1)),e("div",Bt,[m(s,{name:"hi-paper-airplane",class:"text-white animate-pulse",scale:"1.5"})])]),e("p",Et,p(G.value),1)])):S("",!0)])}}}),Ht=Ee(Nt,[["__scopeId","data-v-49004d2c"]]);export{Ht as default};
